(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{lo:()=>U,LL:()=>B,cB:()=>P,po:()=>C,wf:()=>z,B2:()=>A,PW:()=>j,C7:()=>O,IX:()=>x,r9:()=>g,f:()=>k,rC:()=>q,EC:()=>L});var t,n={formSelector:".form",inputSelector:".form__input",submitButton:".popup__submit",disabledButtonSelector:"popup__submit_status_error",errorInputSelector:"form__input_status_error",errorClass:".form__input-error_visible"},o=function(e,t){e.classList.add(t),e.setAttribute("disabled","disabled")},r=document.querySelector(".popup_photo"),c=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i),e.addEventListener("click",u)},a=function(e){document.removeEventListener("keydown",i),e.removeEventListener("click",u),e.classList.remove("popup_opened")},i=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");a(t)}},u=function(e){if(e.target.classList.contains("popup")){var t=e.target.closest(".popup");a(t)}},s={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-2",headers:{authorization:"f8b50c22-f9ea-4450-b40d-792adb8f1524","Content-Type":"application/json"}},l=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function d(e,t){e.querySelector(".popup__submit").textContent=t?"Сохранение...":"Создать"}var p=function(e){document.querySelector(".cards").prepend(function(e){var n=document.querySelector(".card").content.querySelector(".cards__item").cloneNode(!0),o=e._id;return n.querySelector(".cards__name").textContent=e.name,n.querySelector(".cards__img").src=e.link,n.querySelector(".cards__img").alt=e.name,n.querySelector(".cards__btn").addEventListener("click",(function(t){!function(e,t){(function(e,t){return e.target.classList.contains("cards__btn_like")?fetch("".concat(s.baseUrl,"/cards/likes/").concat(t._id),{method:"PUT",headers:{authorization:"".concat(s.headers.authorization),"Content-Type":"application/json"}}).then((function(e){return l(e)})):fetch("".concat(s.baseUrl,"/cards/likes/").concat(t._id),{method:"DELETE",headers:{authorization:"".concat(s.headers.authorization),"Content-Type":"application/json"}}).then((function(e){return l(e)}))})(e,t).then((function(t){e.target.classList.toggle("cards__btn_like"),e.target.parentNode.querySelector(".cards__like-counter").textContent=t.likes.length})).catch((function(e){console.log(e)}))}(t,e)})),n.querySelector(".cards__img").addEventListener("click",(function(){return function(e){r.querySelector(".popup__image").src=e.link,r.querySelector(".popup__image").alt=e.name,r.querySelector(".popup__name").textContent=e.name,c(r)}(e)})),e.owner._id===t&&(n.querySelector(".cards__trash").classList.add("cards__trash_status_visible"),n.querySelector(".cards__trash").addEventListener("click",(function(e){(function(e){return fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return l(e)}))})(o).then((function(t){e.target.closest(".cards__item").remove()}))}))),e.likes&&e.likes.forEach((function(e){e._id===t&&n.querySelector(".cards__btn").classList.add("cards__btn_like")})),n.querySelector(".cards__like-counter").textContent=e.likes.length,n}(e))};var f,_,m,h,y,v,S,b=document.querySelector(".profile"),q=b.querySelector(".profile__name"),L=b.querySelector(".profile__work-place"),E=b.querySelector(".profile__btn-edit"),k=b.querySelector(".profile__avatar"),g=document.querySelector(".popup_profile"),C=g.querySelector(".form__input_name"),z=g.querySelector(".form__input_profile"),x=document.querySelector(".popup_avatar"),T=x.querySelector(".form_avatar"),B=T.querySelector(".form__input_avatar"),j=document.querySelector(".popup_mesto"),U=j.querySelector(".form_mesto"),P=j.querySelector(".form__input_location"),A=j.querySelector(".form__input_url"),O=j.querySelector(".popup__submit_mesto");document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){return a(e.target.closest(".popup"))}))})),E.addEventListener("click",(function(){c(g),C.value=q.textContent,z.value=L.textContent})),g.querySelector(".form_profile").addEventListener("submit",(function(e){var t,n;d(g,!0),(t=C.value,n=z.value,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(s.headers.authorization),"Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return l(e)}))).then((function(e){q.textContent=e.name,L.textContent=e.about,a(g)})).catch((function(e){console.log(e)})).finally((function(){d(g,!1)}))})),k.addEventListener("click",(function(){return c(x)})),T.addEventListener("submit",(function(){var e;(e=B.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(s.headers.authorization),"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return l(e)}))).then((function(e){d(!0),k.src=e.avatar,d(!1),a(x)})).catch((function(e){return console.log(e)}))})),b.querySelector(".profile__btn-add").addEventListener("click",(function(){c(j),o(O,n.disabledButtonSelector)})),U.addEventListener("submit",(function(e){var t,r;d(j,!0),(t=P.value,r=A.value,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:{authorization:"".concat(s.headers.authorization),"Content-Type":"application/json"},body:JSON.stringify({name:t,link:r})}).then((function(e){return l(e)}))).then((function(e){p(e),o(O,n.disabledButtonSelector),a(j),U.reset()})).catch((function(e){console.log(e)})).finally((function(e){d(j,!1)})),o(O,n.disabledButtonSelector)})),Promise.all([fetch("".concat(s.baseUrl,"/users/me"),{method:"GET",headers:{authorization:"".concat(s.headers.authorization)}}).then((function(e){return l(e)})),fetch("".concat(s.baseUrl,"/cards"),{headers:{authorization:"".concat(s.headers.authorization)}}).then((function(e){return l(e)}))]).then((function(e){var n,o,r,c;n=e[0]._id,t=n,o=e[0].name,r=e[0].about,c=e[0].avatar,q.textContent=o,L.textContent=r,k.src=c,e[1].reverse().forEach((function(e){p(e)}))})),_=(f=n).formSelector,m=f.inputSelector,h=f.submitButton,y=f.disabledButtonSelector,v=f.errorInputSelector,S=f.errorClass,document.querySelectorAll(_).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=Array.from(e.querySelectorAll(m)),n=e.querySelector(h);t.forEach((function(e){e.addEventListener("input",(function(r){!function(e,t,n){!function(e){return e.every((function(e){return e.validity.valid}))}(e)?o(t,n):function(e,t){e.classList.remove(t),e.removeAttribute("disabled")}(t,n)}(t,n,y),function(e,t,n){e.validity.valid?function(e,t,n){var o=document.getElementById("".concat(e.name,"-error"));e.classList.remove(t),o.classList.remove(n),o.textContent=""}(e,t,n):function(e,t,n){var o=document.getElementById("".concat(e.name,"-error"));e.classList.add(t),o.textContent=e.validationMessage,o.classList.add(n)}(e,t,n)}(e,v,S)}))}))}))})();